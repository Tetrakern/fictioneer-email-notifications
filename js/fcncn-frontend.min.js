const fcncn_modal=document.getElementById("fcncn-subscription-modal"),fcncn_targetContainer=fcncn_modal?.querySelector('[data-target="fcncn-modal-loader"]'),fcncn_url_params=Object.fromEntries(new URLSearchParams(window.location.search).entries());function fcncn_addEventListeners(){document.querySelector('[data-click-action="auth-mode"]')?.addEventListener("click",(()=>{fcncn_modal.querySelector('[data-target="auth-mode"]').hidden=!1,fcncn_modal.querySelector('[data-target="submit-mode"]').hidden=!0})),document.querySelector('[data-click-action="submit-mode"]')?.addEventListener("click",(()=>{fcncn_modal.querySelector('[data-target="auth-mode"]').hidden=!0,fcncn_modal.querySelector('[data-target="submit-mode"]').hidden=!1})),document.getElementById("fcncn-modal-submit-button")?.addEventListener("click",(n=>{fcncn_subscribe_or_update(n.currentTarget)})),document.getElementById("fcncn-modal-auth-button")?.addEventListener("click",(()=>{fcncn_getModalForm("edit")})),document.querySelector('[data-click-action="fcncn-delete-subscription"]')?.addEventListener("click",(()=>{fcncn_unsubscribe()}))}function fcncn_toggleInProgress(n=!0){fcncn_targetContainer.classList.toggle("ajax-in-progress",n)}function fcncn_getPreparedFormData(n){let e=new FormData(n),c={};for(let[n,t]of e.entries()){let e=n.replace(/\[\]/g,"");c.modifiedKey?c[e].push(t):c[e]=[t]}for(let n in c)Array.isArray(c[n])&&(c[n]=c[n].join(","));return c}function fcncn_getModalForm(n="new"){if("new"==n&&document.getElementById("fcncn-subscription-form"))return;const e=fcncn_url_params["fcncn-email"]??document.getElementById("fcncn-modal-auth-email")?.value??0,c=fcncn_url_params["fcncn-code"]??document.getElementById("fcncn-modal-auth-code")?.value??0;if("edit"==n&&!e&&!c)return;"edit"==n&&fcncn_toggleInProgress();fcn_ajaxPost({action:"fcncn_ajax_get_form_content","auth-email":e,"auth-code":c}).then((n=>{n.success&&(fcncn_targetContainer.innerHTML=n.data.html)})).then((()=>{fcncn_toggleInProgress(!1),fcncn_addEventListeners()}))}function fcncn_subscribe_or_update(n){const e=n.closest("form"),c=document.getElementById("fcncn-modal-submit-email")?.value,t=fcncn_getPreparedFormData(e);if(!c)return void e.reportValidity();fcncn_toggleInProgress();let a={action:"fcncn_ajax_subscribe_or_update",email:c,nonce:fcncn_modal.querySelector('input[name="nonce"]')?.value??""};a={...a,...t},fcn_ajaxPost(a).then((n=>{fcncn_targetContainer.innerHTML=`<div class="fcncn-dialog-modal__notice"><p>${n.data.notice}</p></div>`,fcncn_toggleInProgress(!1)}))}function fcncn_unsubscribe(){fcncn_toggleInProgress();const n={action:"fcncn_ajax_subscribe",email:document.getElementById("fcncn-modal-submit-email")?.value??"",code:document.getElementById("fcncn-modal-submit-code")?.value??0,nonce:fcncn_modal.querySelector('input[name="nonce"]')?.value??""};fcn_ajaxPost(n).then((n=>{fcncn_targetContainer.innerHTML=`<div class="fcncn-dialog-modal__notice"><span>${n.data.notice}</span></div>`,fcncn_toggleInProgress(!1)}))}fcncn_modal&&document.querySelectorAll('[data-click-action*="fcncn-load-modal-form"]').forEach((n=>{n.addEventListener("click",(()=>{fcncn_getModalForm()}),{once:!0})}));