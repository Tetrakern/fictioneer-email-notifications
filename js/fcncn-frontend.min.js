const fcncn_modal=document.getElementById("fcncn-subscription-modal"),fcncn_url_params=Object.fromEntries(new URLSearchParams(window.location.search).entries());function fcncn_addEventListeners(){document.querySelector('[data-click-action="auth-mode"]')?.addEventListener("click",(()=>{fcncn_modal.querySelector('[data-target="auth-mode"]').hidden=!1,fcncn_modal.querySelector('[data-target="submit-mode"]').hidden=!0})),document.querySelector('[data-click-action="submit-mode"]')?.addEventListener("click",(()=>{fcncn_modal.querySelector('[data-target="auth-mode"]').hidden=!0,fcncn_modal.querySelector('[data-target="submit-mode"]').hidden=!1})),document.getElementById("fcnes-modal-submit-button")?.addEventListener("click",(e=>{fcncn_subscribe_or_update(e.currentTarget)})),document.getElementById("fcnes-modal-auth-button")?.addEventListener("click",(()=>{fcncn_getModalForm("edit")})),document.querySelector('[data-click-action="fcncn-delete-subscription"]')?.addEventListener("click",(()=>{fcncn_unsubscribe()}))}function fcncn_getModalForm(e="new"){if("new"==e&&document.getElementById("fcncn-subscription-form"))return;const n=fcncn_modal.querySelector('[data-target="fcncn-modal-loader"]'),c=fcncn_url_params["fcncn-email"]??document.getElementById("fcncn-modal-auth-email")?.value??0,t=fcncn_url_params["fcncn-code"]??document.getElementById("fcncn-modal-auth-code")?.value??0;if("edit"==e&&!c&&!t)return;"edit"==e&&n.classList.add("ajax-in-progress");fcn_ajaxPost({action:"fcncn_ajax_get_form_content",email:c,code:t}).then((e=>{e.success&&(n.innerHTML=e.data.html)})).then((()=>{n.classList.remove("ajax-in-progress"),fcncn_addEventListeners()}))}function fcncn_subscribe_or_update(e){const n=fcncn_modal.querySelector('[data-target="fcncn-modal-loader"]'),c=e.closest("form"),t=document.getElementById("fcncn-modal-submit-email")?.value,a=document.querySelector('input[name="fcncn-scope"]:checked')?.value??"everything",o=document.getElementById("fcncn-modal-submit-code")?.value??0;if(!t)return void c.reportValidity();n.classList.add("ajax-in-progress");const d={action:"fcncn_ajax_subscribe_or_update",email:t,code:o,scope:a,nonce:e.closest(".fcncn-dialog-modal").querySelector('input[name="nonce"]')?.value??""};fcn_ajaxPost(d).then((e=>{console.log(e)})).then((()=>{n.classList.remove("ajax-in-progress")}))}function fcncn_unsubscribe(){const e=fcncn_modal.querySelector('[data-target="fcncn-modal-loader"]'),n=document.getElementById("fcncn-modal-submit-email")?.value,c=document.getElementById("fcncn-modal-submit-code")?.value??0;e.classList.add("ajax-in-progress");const t={action:"fcncn_ajax_subscribe",email:n,code:c,nonce:e.closest(".fcncn-dialog-modal").querySelector('input[name="nonce"]')?.value??""};fcn_ajaxPost(t).then((e=>{console.log(e)})).then((()=>{e.classList.remove("ajax-in-progress")}))}fcncn_modal&&document.querySelectorAll('[data-click-action*="fcncn-load-modal-form"]').forEach((e=>{e.addEventListener("click",(()=>{fcncn_getModalForm()}),{once:!0})}));