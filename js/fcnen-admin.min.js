function fcnen_revealTemplate(e){if(document.querySelectorAll(".fcnen-codemirror").forEach((e=>{e.closest(".fcnen-template-wrapper").classList.add("hidden")})),!e)return fcnen_templatePreview(""),void document.getElementById("fcnen-preview").classList.add("hidden");const n=document.getElementById(e);if(document.getElementById("fcnen-preview").classList.remove("hidden"),n)if(n.classList.remove("hidden"),n.querySelector(".CodeMirror")){fcnen_templatePreview(document.querySelector(".fcnen-template-wrapper:not(.hidden) .CodeMirror").CodeMirror.getValue())}else{wp.codeEditor.initialize(n.querySelector("textarea"),cm_settings);const e=document.querySelector(".fcnen-template-wrapper:not(.hidden) .CodeMirror").CodeMirror;fcnen_templatePreview(e.getValue()),e.on("change",(e=>{fcnen_templatePreview(e.doc.getValue())}))}}function fcnen_templatePreview(e,n=null){const t=document.getElementById("fcnen-preview-iframe"),a=t.contentWindow.document;Object.entries(fcnen_preview_replacements).forEach((([n,t])=>{e=e.replaceAll(n,t)})),e=e.replace(/\{\{[#/^]?[^{}]+\}\}/g,""),a.open(),a.write(e),a.close(),t.style.height=0;const r=n??Math.max(a.body.scrollHeight,a.body.offsetHeight,a.documentElement.clientHeight,a.documentElement.scrollHeight,a.documentElement.offsetHeight);t.style.height=r+"px"}document.querySelectorAll("[data-fcnen-open-modal]").forEach((e=>{e.addEventListener("click",(e=>{document.getElementById(e.currentTarget.dataset.fcnenOpenModal)?.showModal()}))})),document.querySelectorAll(".fcnen-modal").forEach((e=>{e.addEventListener("mousedown",(e=>{"dialog"===e.target.tagName.toLowerCase()&&(e.preventDefault(),e.target.close())}))})),document.querySelectorAll(".fcnen-input-wrap._file").forEach((e=>{e.querySelector('input[type="file"]').addEventListener("change",(n=>{e.querySelector(".fcnen-input-wrap__file-field").textContent=n.currentTarget.files[0].name}))})),document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("fcnen-select-template")?.addEventListener("change",(e=>{fcnen_revealTemplate(e.currentTarget.value)}))}));const fcnen_queueWrapper=document.querySelector('[data-finder="fcnen-email-queue"]'),fcnen_apiLimit=parseInt(fcnen_queueWrapper?.dataset.apiLimit??10),fcnen_apiInterval=parseInt(fcnen_queueWrapper?.dataset.apiInterval??6e4);var fcnen_apiStartTime=0,fcnen_apiRequests=0;function fcnen_handleRateLimiting(){const e=Date.now()-fcnen_apiStartTime;if(e<fcnen_apiInterval&&++fcnen_apiRequests>fcnen_apiLimit){const n=fcnen_queueWrapper.querySelector('[data-status="working"]');return n&&(n.querySelector(".fcnen-queue-batch__status").innerHTML=`<span>${fcnen_queueWrapper.dataset.pauseMessage}</span> <i class="fa-solid fa-spinner fa-spin" style="--fa-animation-duration: .8s;"></i>`),new Promise((n=>setTimeout((()=>{fcnen_apiStartTime=Date.now(),fcnen_apiRequests=0,n()}),fcnen_apiInterval+1e3-e)))}return e>fcnen_apiInterval&&(fcnen_apiStartTime=Date.now(),fcnen_apiRequests=0),Promise.resolve()}function fcnen_processQueue(e,n=0,t=0){fcnen_handleRateLimiting().then((()=>{const a={action:"fictioneer_ajax_fcnen_process_email_queue",index:n,new:t,fcnen_queue_nonce:document.getElementById("fcnen_queue_nonce").value??""};fcn_ajaxPost(a).then((n=>{if(n.success){if("empty"===n.data.result)fcnen_queueWrapper.innerHTML=n.data.message;else fcnen_queueWrapper.innerHTML=n.data.html;n.data.next>-1&&fcnen_processQueue(e,n.data.next)}else fcnen_queueWrapper.innerHTML=n.data.error})).catch((e=>{console.error("Error:",e)}))}))}document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll('[data-click-action*="fcnen-work-queue"]').forEach((e=>{e.addEventListener("click",(e=>{e.currentTarget.disabled=!0,fcnen_apiStartTime=Date.now(),fcnen_apiRequests=0,fcnen_processQueue(e.currentTarget,0,1)}))}))}));